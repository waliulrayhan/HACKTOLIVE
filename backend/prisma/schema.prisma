generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model User {
  id           String        @id @default(uuid())
  email        String        @unique
  name         String?
  password     String
  role         UserRole      @default(STUDENT)
  createdAt    DateTime      @default(now())
  updatedAt    DateTime      @updatedAt
  avatar       String?       @db.VarChar(500)
  bio          String?
  city         String?
  country      String?
  facebookUrl  String?       @db.VarChar(500)
  instagramUrl String?       @db.VarChar(500)
  linkedinUrl  String?       @db.VarChar(500)
  phone        String?
  state        String?
  twitterUrl   String?       @db.VarChar(500)
  githubUrl    String?       @db.VarChar(500)
  websiteUrl   String?       @db.VarChar(500)
  blogs        Blog[]
  comments     BlogComment[]
  instructor   Instructor?
  reviews      Review[]
  student      Student?
}

model Instructor {
  id            String        @id @default(uuid())
  userId        String        @unique
  experience    String?       @db.VarChar(500)
  skills        String        @db.Text
  rating        Float         @default(0)
  totalStudents Int           @default(0)
  totalCourses  Int           @default(0)
  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt
  certificates  Certificate[]
  courses       Course[]
  user          User          @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([rating])
  @@index([totalStudents])
}

model Student {
  id                    String                 @id @default(uuid())
  userId                String                 @unique
  enrolledCourses       Int                    @default(0)
  completedCourses      Int                    @default(0)
  certificatesEarned    Int                    @default(0)
  createdAt             DateTime               @default(now())
  updatedAt             DateTime               @updatedAt
  assignmentSubmissions AssignmentSubmission[]
  certificates          Certificate[]
  enrollments           Enrollment[]
  progress              LessonProgress[]
  quizAttempts          QuizAttempt[]
  user                  User                   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model Course {
  id               String         @id @default(uuid())
  slug             String         @unique @db.VarChar(255)
  title            String         @db.VarChar(255)
  shortDescription String         @db.Text
  description      String         @db.Text
  thumbnail        String?        @db.VarChar(500)
  category         CourseCategory
  level            CourseLevel
  tier             CourseTier
  deliveryMode     DeliveryMode
  price            Float          @default(0)
  instructorId     String
  rating           Float          @default(0)
  totalRatings     Int            @default(0)
  totalStudents    Int            @default(0)
  duration         Int
  totalLessons     Int            @default(0)
  totalModules     Int            @default(0)
  learningOutcomes String         @db.Text
  requirements     String         @db.Text
  tags             String         @db.Text
  liveSchedule     String?        @db.VarChar(255)
  startDate        DateTime?
  endDate          DateTime?
  maxStudents      Int?
  enrolledStudents Int            @default(0)
  meetingLink      String?        @db.VarChar(500)
  status           CourseStatus   @default(DRAFT)
  createdAt        DateTime       @default(now())
  updatedAt        DateTime       @updatedAt
  certificates     Certificate[]
  instructor       Instructor     @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  modules          CourseModule[]
  enrollments      Enrollment[]
  reviews          Review[]

  @@index([slug])
  @@index([category])
  @@index([level])
  @@index([tier])
  @@index([status])
  @@index([instructorId])
  @@index([rating])
}

model CourseModule {
  id          String   @id @default(uuid())
  courseId    String
  title       String   @db.VarChar(255)
  description String?  @db.Text
  order       Int
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
  course      Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  lessons     Lesson[]

  @@index([courseId])
  @@index([order])
}

model Lesson {
  id             String           @id @default(uuid())
  moduleId       String
  title          String           @db.VarChar(255)
  description    String?          @db.Text
  type           LessonType
  duration       Int
  videoUrl       String?          @db.VarChar(500)
  articleContent String?          @db.Text
  isPreview      Boolean          @default(false)
  order          Int
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  assignments    Assignment[]
  module         CourseModule     @relation(fields: [moduleId], references: [id], onDelete: Cascade)
  progress       LessonProgress[]
  resources      LessonResource[]
  quizzes        Quiz[]

  @@index([moduleId])
  @@index([order])
  @@index([type])
}

model LessonResource {
  id        String       @id @default(uuid())
  lessonId  String
  name      String       @db.VarChar(255)
  type      ResourceType
  url       String       @db.VarChar(500)
  size      String?      @db.VarChar(50)
  createdAt DateTime     @default(now())
  lesson    Lesson       @relation(fields: [lessonId], references: [id], onDelete: Cascade)

  @@index([lessonId])
}

model Enrollment {
  id                   String           @id @default(uuid())
  studentId            String
  courseId             String
  enrolledAt           DateTime         @default(now())
  status               EnrollmentStatus @default(ACTIVE)
  progress             Float            @default(0)
  lastAccessedLessonId String?
  completedAt          DateTime?
  createdAt            DateTime         @default(now())
  updatedAt            DateTime         @updatedAt
  course               Course           @relation(fields: [courseId], references: [id], onDelete: Cascade)
  student              Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, courseId])
  @@index([studentId])
  @@index([courseId])
  @@index([status])
}

model LessonProgress {
  id          String    @id @default(uuid())
  studentId   String
  lessonId    String
  completed   Boolean   @default(false)
  completedAt DateTime?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  lesson      Lesson    @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  student     Student   @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@unique([studentId, lessonId])
  @@index([studentId])
  @@index([lessonId])
  @@index([completed])
}

model Review {
  id        String   @id @default(uuid())
  courseId  String
  userId    String
  rating    Int
  comment   String?  @db.Text
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  course    Course   @relation(fields: [courseId], references: [id], onDelete: Cascade)
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@index([courseId])
  @@index([userId])
  @@index([rating])
}

model Certificate {
  id               String            @id @default(uuid())
  studentId        String
  courseId         String
  instructorId     String
  status           CertificateStatus @default(PENDING)
  requestedAt      DateTime          @default(now())
  issuedAt         DateTime?
  verificationCode String?           @unique @db.VarChar(255)
  certificateUrl   String?           @db.VarChar(500)
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  course           Course            @relation(fields: [courseId], references: [id], onDelete: Cascade)
  instructor       Instructor        @relation(fields: [instructorId], references: [id], onDelete: Cascade)
  student          Student           @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([studentId])
  @@index([courseId])
  @@index([instructorId])
  @@index([verificationCode])
  @@index([status])
}

model Quiz {
  id           String         @id @default(uuid())
  lessonId     String
  title        String         @db.VarChar(255)
  description  String?        @db.Text
  passingScore Int
  timeLimit    Int?
  createdAt    DateTime       @default(now())
  updatedAt    DateTime       @updatedAt
  lesson       Lesson         @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  attempts     QuizAttempt[]
  questions    QuizQuestion[]

  @@index([lessonId])
}

model QuizQuestion {
  id            String       @id @default(uuid())
  quizId        String
  question      String       @db.Text
  type          QuestionType
  options       String       @db.Text
  correctAnswer String       @db.Text
  explanation   String?      @db.Text
  order         Int
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  quiz          Quiz         @relation(fields: [quizId], references: [id], onDelete: Cascade)

  @@index([quizId])
  @@index([order])
}

model QuizAttempt {
  id          String   @id @default(uuid())
  quizId      String
  studentId   String
  score       Float
  answers     String   @db.LongText
  passed      Boolean
  attemptedAt DateTime @default(now())
  createdAt   DateTime @default(now())
  quiz        Quiz     @relation(fields: [quizId], references: [id], onDelete: Cascade)
  student     Student  @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([quizId])
  @@index([studentId])
  @@index([passed])
}

model Assignment {
  id           String                 @id @default(uuid())
  lessonId     String
  title        String                 @db.VarChar(255)
  description  String                 @db.Text
  instructions String?                @db.Text
  dueDate      DateTime?
  maxScore     Int                    @default(100)
  createdAt    DateTime               @default(now())
  updatedAt    DateTime               @updatedAt
  lesson       Lesson                 @relation(fields: [lessonId], references: [id], onDelete: Cascade)
  submissions  AssignmentSubmission[]

  @@index([lessonId])
}

model AssignmentSubmission {
  id             String           @id @default(uuid())
  assignmentId   String
  studentId      String
  submissionUrl  String?          @db.VarChar(500)
  submissionText String?          @db.Text
  score          Int?
  feedback       String?          @db.Text
  status         SubmissionStatus @default(PENDING)
  submittedAt    DateTime         @default(now())
  gradedAt       DateTime?
  createdAt      DateTime         @default(now())
  updatedAt      DateTime         @updatedAt
  assignment     Assignment       @relation(fields: [assignmentId], references: [id], onDelete: Cascade)
  student        Student          @relation(fields: [studentId], references: [id], onDelete: Cascade)

  @@index([assignmentId])
  @@index([studentId])
  @@index([status])
}

model Blog {
  id          String        @id @default(uuid())
  slug        String        @unique @db.VarChar(255)
  title       String        @db.VarChar(500)
  mainImage   String?       @db.VarChar(500)
  metadata    String        @db.Text
  content     String?       @db.LongText
  category    BlogCategory
  blogType    BlogType
  authorId    String
  publishDate DateTime      @default(now())
  readTime    String?       @db.VarChar(50)
  tags        String        @db.Text
  featured    Boolean       @default(false)
  status      BlogStatus    @default(DRAFT)
  views       Int           @default(0)
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  author      User          @relation(fields: [authorId], references: [id], onDelete: Cascade)
  comments    BlogComment[]
  likes       BlogLike[]

  @@index([slug])
  @@index([category])
  @@index([blogType])
  @@index([status])
  @@index([featured])
  @@index([publishDate])
  @@index([authorId])
}

model BlogComment {
  id        String            @id @default(uuid())
  blogId    String
  userId    String
  comment   String            @db.Text
  createdAt DateTime          @default(now())
  updatedAt DateTime          @updatedAt
  parentId  String?
  blog      Blog              @relation(fields: [blogId], references: [id], onDelete: Cascade)
  parent    BlogComment?      @relation("CommentReplies", fields: [parentId], references: [id], onDelete: Cascade)
  replies   BlogComment[]     @relation("CommentReplies")
  user      User              @relation(fields: [userId], references: [id], onDelete: Cascade)
  likes     BlogCommentLike[]

  @@index([blogId])
  @@index([userId])
  @@index([parentId])
}

model BlogLike {
  id        String   @id @default(uuid())
  blogId    String
  userId    String?
  userEmail String?  @db.VarChar(255)
  createdAt DateTime @default(now())
  blog      Blog     @relation(fields: [blogId], references: [id], onDelete: Cascade)

  @@unique([blogId, userEmail])
  @@index([blogId])
  @@index([userId])
}

model BlogCommentLike {
  id        String      @id @default(uuid())
  commentId String
  userEmail String?     @db.VarChar(255)
  createdAt DateTime    @default(now())
  comment   BlogComment @relation(fields: [commentId], references: [id], onDelete: Cascade)

  @@unique([commentId, userEmail])
  @@index([commentId])
}

enum CertificateStatus {
  PENDING
  ISSUED
  REJECTED
}

enum UserRole {
  STUDENT
  INSTRUCTOR
  ADMIN
}

enum CourseCategory {
  WEB_SECURITY
  NETWORK_SECURITY
  MALWARE_ANALYSIS
  PENETRATION_TESTING
  CLOUD_SECURITY
  CRYPTOGRAPHY
  INCIDENT_RESPONSE
  SECURITY_FUNDAMENTALS
}

enum CourseLevel {
  FUNDAMENTAL
  INTERMEDIATE
  ADVANCED
}

enum CourseTier {
  FREE
  PREMIUM
}

enum DeliveryMode {
  RECORDED
  LIVE
}

enum CourseStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}

enum LessonType {
  VIDEO
  ARTICLE
  QUIZ
  ASSIGNMENT
}

enum ResourceType {
  PDF
  ZIP
  LINK
  DOC
}

enum EnrollmentStatus {
  ACTIVE
  COMPLETED
  DROPPED
}

enum QuestionType {
  MCQ
  TRUE_FALSE
  MULTIPLE_SELECT
}

enum SubmissionStatus {
  PENDING
  SUBMITTED
  GRADED
  RETURNED
}

enum BlogCategory {
  CYBERSECURITY_INSIGHTS
  NEWS
  TUTORIALS
}

enum BlogType {
  THREAT_ALERTS
  HOW_TO_TUTORIALS
  BEST_SECURITY_PRACTICES
  COMPLIANCE_GUIDES
  CASE_STUDY_STORIES
}

enum BlogStatus {
  DRAFT
  PUBLISHED
  ARCHIVED
}
